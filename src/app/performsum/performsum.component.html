<div *ngIf="loading">Loading performance data...</div>
<div *ngIf="errorMessage">{{ errorMessage }}</div>

<div class="body" *ngIf="performanceData && !loading">
  <div class="dashboard">
    <h2 class="headlevel-three">{{ greeting }}, {{ UserName }}</h2>
    <div class="cards">
      <div class="card">
        <div class="icon-block">
          <div class="icon" (click)="openPerformancePopup()">
            <img
              src="assets/images/icons/tperform.png"
              alt="Weekly work hour"
            />
          </div>
        </div>
        <h4 class="perf-cont">Performance Score</h4>
        <p class="value">{{ performanceData.performance_score }}</p>

        <!-- Model Popup Performance Score -->

        <!-- Popup Modal -->
        <div class="popup-overlay" *ngIf="showPerformancePopup">
          <div class="popup-content">
            <div class="popup-header">
              <h3 class="headlevel-three mb-0">Performance Score</h3>
              <button class="closeicon" (click)="closePerformancePopup()">
                X
              </button>
            </div>
            <div class="popup-body">
              <div class="table-container">
                <div class="table-responsive">
                  <div class="common-table">
                    <table class="table table-bordered table-striped">
                      <thead>
                        <tr>
                          <th>S.No</th>
                          <th>Date</th>
                          <th>Name</th>
                          <th>Task</th>
                          <th>DeadLine Date</th>
                          <th>Status</th>
                          <th>Score</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>1</td>
                          <td>17/05/2025</td>
                          <td>Bob Johnson</td>
                          <td>Logo Design</td>
                          <td>17/05/2025</td>
                          <td>Completed</td>
                          <td>85%</td>
                        </tr>
                        <tr>
                          <td>2</td>
                          <td>18/05/2025</td>
                          <td>Bob Johnson</td>
                          <td>Mobile Application Figma Design</td>
                          <td>18/05/2025</td>
                          <td>Completed</td>
                          <td>80%</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="icon-block">
          <div class="icon" (click)="openGoalProgressPopup()">
            <img
              src="assets/images/icons/lucide_goal.png"
              alt="Weekly work hour"
            />
          </div>

        </div>
        <h4 class="perf-cont">Goal Progress</h4>
        <p class="value">{{ performanceData.completed_percentage }}</p>
        <!-- <div class="legend">
          <span class="completed"></span> Completed
          <span class="remaining"></span> Remaining
        </div> -->
        <!-- Popup Modal -->
        <div class="popup-overlay" *ngIf="showGoalProgressPopup">
          <div class="popup-content">
            <div class="popup-header">
              <h3 class="headlevel-three mb-0">Goal Progress</h3>
              <button class="closeicon" (click)="closeGoalProgressPopup()">
                X
              </button>
            </div>
            <div class="popup-body">
              <div class="table-container">
                <div class="table-responsive">
                  <div class="common-table">
                    <table class="table table-bordered table-striped">
                      <thead>
                        <tr>
                          <th>S.No</th>
                          <th>Date</th>
                          <th>Name</th>
                          <th>Goals</th>
                          <th>DeadLine Date</th>
                          <th>Status</th>
                          <th>Score</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>1</td>
                          <td>19/05/2025</td>
                          <td>Bob Johnson</td>
                          <td>Completed the project in before deadline Date [19-05-2025]</td>
                          <td>20/05/2025</td>
                          <td>Pending</td>
                          <td>0</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="icon-block">
          <div class="icon" (click)="openRatingProgressPopup()">
            <img
              src="assets/images/icons/speedrate.png"
              alt="Weekly work hour"
            />
          </div>
        </div>
        <h4 class="perf-cont">Performance Ratings</h4>
        <p class="value">
          {{ performanceData.performance_rating_out_of_5 }} / 5
        </p>
         <!-- Popup Modal -->
        <div class="popup-overlay" *ngIf="showRatingProgressPopup">
          <div class="popup-content">
            <div class="popup-header">
              <h3 class="headlevel-three mb-0">Performance Ratings</h3>
              <button class="closeicon" (click)="closeRatingProgressPopup()">
                X
              </button>
            </div>
            <div class="popup-body">
              <div class="table-container">
                <div class="table-responsive">
                  <div class="common-table">
                    <table class="table table-bordered table-striped">
                      <thead>
                        <tr>
                          <th>S.No</th>
                          <th>Date</th>
                          <th>Name</th>
                          <th>Project</th>
                          <th>Overall Task updates</th>
                          <th>Performance Score</th>
                          <th>Rating</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>1</td>
                          <td>19/05/2025</td>
                          <td>Bob Johnson</td>
                          <td>Enzopik Mobile Application</td>
                          <td>Ontime Completing</td>
                          <td>60%</td>
                          <td>5</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="icon-block">
          <div class="icon" (click)="openMontlyAttendancePopup()">
            <img src="assets/images/icons/track.png" alt="Weekly work hour" />
          </div>
        </div>
        <h4 class="perf-cont">Average Monthly Attendance</h4>
        <p class="value">78%</p>
        <!-- Popup Modal -->
        <div class="popup-overlay" *ngIf="showMontlyAttendancePopup">
          <div class="popup-content">
            <div class="popup-header">
              <h3 class="headlevel-three mb-0">Average Monthly Attendance</h3>
              <button class="closeicon" (click)="closeMontlyAttendancePopup()">
                X
              </button>
            </div>
            <div class="popup-body">
              <div class="table-container">
                <div class="table-responsive">
                  <div class="common-table">
                    <table class="table table-bordered table-striped">
                      <thead>
                        <tr>
                          <th>S.No</th>
                          <th>Name</th>
                          <th>Month</th>
                          <th>Average Check-in</th>
                          <th>Average Check-out</th>
                          <th>Leaves</th>
                          <th>Permissions</th>
                          <th>Average Attendance</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>1</td>
                          <td>Bob Johnson</td>
                          <td>April 2025</td>
                          <td>9:10AM</td>
                          <td>6:05PM</td>
                          <td>2</td>
                          <td>1</td>
                          <td>97%</td>
                        </tr>
                        <tr>
                          <td>2</td>
                          <td>Bob Johnson</td>
                          <td>May 2025</td>
                          <td>9:10AM</td>
                          <td>6:05PM</td>
                          <td>3</td>
                          <td>1</td>
                          <td>96%</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Goal Data  -->

<div *ngIf="loading">Loading user goals...</div>
<div *ngIf="errorMessage">{{ errorMessage }}</div>
<div class="body">
  <div class="goals-block">
    <section class="goals-overview">
      <h2 class="headlevel-three">Current Goals</h2>
      <div class="cards">
        <div class="card">
          <div class="icon-block">
            <div class="icon" (click)="openCompleteTaskPopup()">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                id="Layer_1"
                class="icon-col-prim icon-24"
                data-name="Layer 1"
                width="27"
                height="30"
                viewBox="0 0 27 30"
              >
                <path
                  d="m27,30l-27-.2V0h17.7l9.3,8.4v21.6Zm-25-2.2l23,.2V9.3l-8-7.3H2v25.8Z"
                />
                <polygon
                  points="25.3 10.2 15.9 10.2 15.9 1.9 17.9 1.9 17.9 8.2 25.3 8.2 25.3 10.2"
                />
              </svg>
            </div>
          </div>
          <h4 class="perf-cont">Completed Task</h4>
          <p class="value">{{ totalCompleted }}</p>
            <div class="popup-overlay" *ngIf="showCompleteTaskPopup">
          <div class="popup-content">
            <div class="popup-header">
              <h3 class="headlevel-three mb-0">Completed Task</h3>
              <button class="closeicon" (click)="closeCompleteTaskPopup()">
                X
              </button>
            </div>
            <div class="popup-body">
              <div class="table-container">
                <div class="table-responsive">
                  <div class="common-table">
                    <table class="table table-bordered table-striped">
                      <thead>
                        <tr>
            <th>S.No</th>
            <th>Date</th>
            <th>Task</th>
            <th>Deadline</th>
            <th>Status</th>
            <th>Progress Note</th>
            <th>Next Step</th>
          </tr>
                      </thead>
                      <tbody *ngIf="!loading && tasks.length">
          <tr *ngFor="let task of tasks| paginate
                    : { itemsPerPage: itemsPerPage, currentPage: currentPage };let i = index">
                    <td>{{ i + 1 }}.</td>
            <td>{{ task.date }}</td>
            <td>{{ task.description }}</td>
            <td>{{ task.deadline }}</td>
            <td>{{ task.status }}</td>
            <td>{{ task.progress_note }}</td>
            <td>Follow up with potential clients</td>
          </tr>
        </tbody>
                    </table>
                  </div>
                   <!-- Pagination controls -->
                      <div class="pagination-wrapper mt-3">
                        <pagination-controls
                          (pageChange)="currentPage = $event"
                        ></pagination-controls>
                      </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        </div>

        <div class="card">
          <div class="icon-block">
            <div class="icon" (click)="openCompleteProjectPopup()">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                id="Layer_1"
                class="icon-col-prim icon-24"
                data-name="Layer 1"
                width="28"
                height="31"
                viewBox="0 0 28 31"
              >
                <path
                  d="m14,31c-7.7,0-14-5.9-14-13.2S6.3,4.5,14,4.5s14,5.9,14,13.2-6.3,13.2-14,13.2Zm0-23.5c-6.1,0-11,4.6-11,10.2s4.9,10.2,11,10.2,11-4.6,11-10.2-4.9-10.2-11-10.2Z"
                />
                <polygon
                  points="11.4 24.9 6.6 19.3 2.3 19.3 2.3 16.3 8 16.3 10.8 19.6 17 8 20.7 16.3 25.5 16.3 25.5 19.3 18.8 19.3 16.8 14.8 11.4 24.9"
                />
                <rect
                  x="23.1"
                  y="6"
                  width="3.8"
                  height="3"
                  transform="translate(1.2 18.3) rotate(-41)"
                />
                <rect x="9.7" width="8.5" height="3" />
              </svg>
            </div>
          </div>
          <h4 class="perf-cont">Completed Project</h4>
          <p class="value">{{ completedProject || 2 }} </p>
          <!-- Popup Modal -->
        <div class="popup-overlay" *ngIf="showCompleteProjectPopup">
          <div class="popup-content">
            <div class="popup-header">
              <h3 class="headlevel-three mb-0">Completed Project</h3>
              <button class="closeicon" (click)="closeCompleteProjectPopup()">
                X
              </button>
            </div>
            <div class="popup-body">
              <div class="table-container">
                <div class="table-responsive">
                  <div class="common-table">
                    <table class="table table-bordered table-striped">
                      <thead>
                        <tr>
                          <th>S.No</th>
                          <th>Name</th>
                          <th>Pojects</th>
                          <th>Deadline Date</th>
                          <th>Status</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>1</td>
                          <td>Bob Johnson</td>
                          <td>Fuoday</td>
                          <td>10/06/2025</td>
                          <td>Completed</td>
                        </tr>
                        <tr>
                          <td>2</td>
                          <td>Bob Johnson</td>
                          <td>Enzopik</td>
                          <td>05/06/2025</td>
                          <td>Completed</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        </div>

        <div class="card">
          <div class="icon-block">
            <div class="icon" (click)="openPendingGoalPopup()">
              <!-- <img src="assets/images/icons/speedrate.png" alt="Weekly work hour"> -->
              <svg
                xmlns="http://www.w3.org/2000/svg"
                id="Layer_1"
                class="icon-col-prim icon-24"
                data-name="Layer 1"
                width="27"
                height="30"
                viewBox="0 0 27 30"
              >
                <path
                  d="m11.5,24.7c-5.7,0-10.6-.6-11.2-2.4-.8-2.5.7-3.9,1.7-4.9.3-.3.8-.7.8-.9,0-.4-.1-1-.3-1.6-.3-1.2-.7-2.7-.2-4.2,1.1-3.2,7.8-8,8.6-8.5l1.1,1.6c-1.9,1.3-7.1,5.3-7.9,7.5-.3.9,0,2,.2,3.1.2.7.4,1.4.4,2.1,0,1-.7,1.7-1.4,2.4-1,1-1.6,1.6-1.2,2.8,1.1,1.3,12.5,1.2,22.5.3.2-.1.6-.5.3-1.8-.1-.7-.9-1.2-1.5-1.6l-.3-.2c-.8-.6-1.1-1.3-1.4-2,0-.1-.1-.3-.2-.4v-.3c-.9-1.7-2-4-.5-5.5l1.4,1.4c-.5.4.3,2.2.8,3.2v.3c.2.1.3.3.3.4.2.5.4.9.7,1.2l.3.2c.8.5,2,1.4,2.3,2.8.6,2.7-.9,3.9-1.7,4.2h-.2c-3.9.4-9,.7-13.5.7Z"
                />
                <path
                  d="m18.7,10c-2.8,0-5.1-2.2-5.1-5S15.9,0,18.7,0s5.1,2.2,5.1,5-2.3,5-5.1,5Zm0-8c-1.7,0-3.1,1.3-3.1,3s1.4,3,3.1,3,3.1-1.3,3.1-3-1.4-3-3.1-3Z"
                />
                <path
                  d="m13,30c-3.1,0-5.6-2.7-5.6-6h2c0,2.2,1.6,4,3.6,4s3.6-1.8,3.6-4h2c0,3.3-2.5,6-5.6,6Z"
                />
              </svg>
            </div>
          </div>
          <h4 class="perf-cont">Pending Goals</h4>
          <p class="value">{{ totalPending }}</p>
           <!-- Popup Modal -->
        <div class="popup-overlay" *ngIf="showPendingGoalPopup">
          <div class="popup-content">
            <div class="popup-header">
              <h3 class="headlevel-three mb-0">Pending Goals</h3>
              <button class="closeicon" (click)="closePendingGoalPopup()">
                X
              </button>
            </div>
            <div class="popup-body">
              <div class="table-container">
                <div class="table-responsive">
                  <div class="common-table">
                    <table class="table table-bordered table-striped">
                      <thead>
                        <tr>
                          <th>S.No</th>
                          <th>Name</th>
                          <th>Pojects</th>
                          <th>Pending Goals</th>
                          <th>Status</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>1</td>
                          <td>Bob Johnson</td>
                          <td>Fuoday</td>
                          <td>ATS </td>
                          <td>Pending</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        </div>

        <div class="card">
          <div class="icon-block">
            <div class="icon" (click)="openUpcammingProjectPopup()">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                id="Layer_1"
                class="icon-col-prim icon-24"
                data-name="Layer 1"
                width="28"
                height="31"
                viewBox="0 0 28 31"
              >
                <path
                  d="m14,31c-7.7,0-14-5.9-14-13.2S6.3,4.5,14,4.5s14,5.9,14,13.2-6.3,13.2-14,13.2Zm0-23.5c-6.1,0-11,4.6-11,10.2s4.9,10.2,11,10.2,11-4.6,11-10.2-4.9-10.2-11-10.2Z"
                />
                <polygon
                  points="11.4 24.9 6.6 19.3 2.3 19.3 2.3 16.3 8 16.3 10.8 19.6 17 8 20.7 16.3 25.5 16.3 25.5 19.3 18.8 19.3 16.8 14.8 11.4 24.9"
                />
                <rect
                  x="23.1"
                  y="6"
                  width="3.8"
                  height="3"
                  transform="translate(1.2 18.3) rotate(-41)"
                />
                <rect x="9.7" width="8.5" height="3" />
              </svg>
            </div>
          </div>
          <h4 class="perf-cont">Upcoming Projects</h4>
          <p class="value">{{ upcommingProject || 2 }}</p>
           <!-- Popup Modal -->
        <div class="popup-overlay" *ngIf="showUpcammingProjectPopup">
          <div class="popup-content">
            <div class="popup-header">
              <h3 class="headlevel-three mb-0">Upcoming Projects</h3>
              <button class="closeicon" (click)="closeUpcammingProjectPopup()">
                X
              </button>
            </div>
            <div class="popup-body">
              <div class="table-container">
                <div class="table-responsive">
                  <div class="common-table">
                    <table class="table table-bordered table-striped">
                      <thead>
                        <tr>
                          <th>S.No</th>
                          <th>Name</th>
                          <th>Pojects</th>
                          <th>Deadline Date</th>
                          <th>Status</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr>
                          <td>1</td>
                          <td>Bob Johnson</td>
                          <td>TeleCRM</td>
                          <td>-</td>
                          <td>-</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        </div>
      </div>
    </section>

    <section class="progress-tracking table-container">
      <h2 class="headlevel-three">Goal Progress Tracking</h2>
      <table class="progress-table">
        <thead>
                        <tr>
            <th>S.No</th>
            <th>Date</th>
            <th>Task</th>
            <th>Deadline</th>
            <th>Status</th>
            <th>Progress Note</th>
            <th>Next Step</th>
          </tr>
                      </thead>
                      <tbody *ngIf="!loading && tasks.length">
          <tr *ngFor="let task of tasks| paginate
                    : { itemsPerPage: itemsPerPage, currentPage: currentPage };let i = index">
                    <td>{{ i + 1 }}.</td>
            <td>{{ task.date }}</td>
            <td>{{ task.description }}</td>
            <td>{{ task.deadline }}</td>
            <td>{{ task.status }}</td>
            <td>{{ task.progress_note }}</td>
            <td>Follow up with potential clients</td>
          </tr>
        </tbody>
      </table>
       <!-- Pagination controls -->
                      <div class="pagination-wrapper mt-3">
                        <pagination-controls
                          (pageChange)="currentPage = $event"
                        ></pagination-controls>
                      </div>
    </section>
  </div>
</div>

<!-- Goal  -->

<!-- <div *ngIf="loading">Loading user goals...</div>
<div *ngIf="errorMessage">{{ errorMessage }}</div>

<div *ngIf="!loading && tasks.length">
  <h3>Task Summary</h3>
  <ul>
    <li>Completed: {{ totalCompleted }}</li>
    <li>Pending: {{ totalPending }}</li>
    <li>In Progress: {{ totalInProgress }}</li>
  </ul>

  <h3>Task List</h3>
  <table>
    <thead>
      <tr>
        <th>Description</th>
        <th>Assigned By</th>
        <th>Project</th>
        <th>Priority</th>
        <th>Status</th>
        <th>Start Date</th>
        <th>Deadline</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let task of tasks">
        <td>{{ task.description }}</td>
        <td>{{ task.assigned_by?.name || 'N/A' }}</td>
        <td>{{ task.project?.name || 'N/A' }}</td>
        <td>{{ task.priority }}</td>
        <td>{{ task.status }}</td>
        <td>{{ task.date }}</td>
        <td>{{ task.deadline }}</td>
      </tr>
    </tbody>
  </table>
</div> -->
