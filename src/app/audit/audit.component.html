<!-- <div class="audit-wrapper">
  <h2 class="headlevel-three"><i class="icon-user"></i> Employee Information</h2>
  <div class="info-card">
    <p><span>Employee Name:</span> {{ employee.name }}</p>
    <p><span>Emp ID:</span> {{ employee.empId }}</p>
    <p><span>Department:</span> {{ employee.department }}</p>
    <p><span>Designation:</span> {{ employee.designation }}</p>
    <p><span>Reporting Manager:</span> {{ employee.manager }}</p>
    <p><span>Date of Joining:</span> {{ employee.doj }}</p>
    <p><span>Attendance Summary:</span> {{ employee.attendance }}</p>
    <p><span>Payroll (May 2025):</span> {{ employee.payroll }}</p>
  </div>

  <form [formGroup]="auditForm" (ngSubmit)="submitForm()" enctype="multipart/form-data" class="audit-form">
    <h2 class="headlevel-three"><i class="icon-edit"></i> Section 1: Task & Project Summary</h2>
    <div class="form-card">
      <label>Key Responsibilities</label>
      <textarea formControlName="keyResponsibilities" placeholder="Maintained and updated backend APIs for ResumeHub Module."></textarea>

      <label>Top 3 Accomplishments</label>
      <textarea formControlName="topAccomplishments" placeholder="1. Integrated Mistral AI
2. Refactored Flask API
3. Dockerized services"></textarea>

      <label>Project(s) Worked On</label>
      <input type="text" formControlName="projectsWorkedOn" placeholder="ResumeHub, HRChatbot, ATS Analyzer" />
    </div>

    <h2 class="headlevel-three"><i class="icon-edit"></i> Section 2: Challenges & Support</h2>
    <div class="form-card">
      <label>Challenges Faced</label>
      <textarea formControlName="challengesFaced" placeholder="Delayed dependencies from frontend team."></textarea>

      <label>Support Required</label>
      <textarea formControlName="supportRequired" placeholder="Need DevOps help with CI/CD pipeline fixes."></textarea>
    </div>

    <h2 class="headlevel-three"><i class="icon-edit"></i> Section 3: Goals & Growth</h2>
    <div class="form-card">
      <label>Previous Month's Goals</label>
      <textarea formControlName="previousGoals" placeholder="Complete ResumeHub integration by 25th May."></textarea>

      <label>Goal Completion Status</label>
      <select formControlName="goalCompletionStatus">
        <option value="completed">✅ Completed</option>
        <option value="not_completed">❌ Not Completed</option>
      </select>

      <label>Goals for Next Month</label>
      <textarea formControlName="nextMonthGoals" placeholder="Deploy V2.0, improve response time by 30%."></textarea>

      <label>Learning/Upskilling Done</label>
      <textarea formControlName="learningDone" placeholder="Completed Docker & MongoDB optimization course."></textarea>
    </div>

    <h2 class="headlevel-three"><i class="icon-edit"></i> Section 4: Self-Rating & Reflection</h2>
    <div class="form-card">
      <label>Self-Rating (1–5)</label>
      <input type="number" min="1" max="5" formControlName="selfRating" placeholder="4" />

      <label>Areas to Improve</label>
      <textarea formControlName="areasToImprove" placeholder="Time management, cross-team sync."></textarea>

      <label>Personal Highlights</label>
      <textarea formControlName="personalHighlights" placeholder="Handled critical bug fix during off-hours."></textarea>

      <label>Feedback/Suggestions</label>
      <textarea formControlName="feedbackSuggestions" placeholder="Would like a shared documentation portal."></textarea>
    </div>

    <h2 class="headlevel-three"><i class="icon-edit"></i> Section 5: Uploads (Optional)</h2>
    <div class="form-card">
      <label>Attach Evidence/Docs</label>
      <input type="file" (change)="onFileSelected($event)" />
      <small>Monthly report, screenshots, KPI chart</small>
    </div> -->

<!-- <div *ngIf="employee.designation === 'Reporting Manager'"> -->
<!-- <div>
      <h2 class="headlevel-three"><i class="icon-briefcase"></i> Manager Review</h2>
      <div class="form-card">
        <label>Work Justification</label>
        <textarea formControlName="workJustification" placeholder="Justify the work"></textarea>

        <label>Manager Rating (1–5)</label>
        <input type="text" formControlName="managerRating" placeholder="1–5" />

        <label>Final Remarks</label>
        <textarea formControlName="finalRemarks" placeholder="Final Remarks"></textarea>

        <label>Submission Status</label>
        <select formControlName="submissionStatus">
          <option>Submitted to Management</option>
          <option>Pending Review</option>
        </select>
      </div>
    </div> -->
<!-- <h2 class="headlevel-three"><i class="icon-edit"></i> Section 6: Final Reflections</h2>
<div class="form-card">
  <label>Task Highlights</label>
  <textarea formControlName="taskHighlights" placeholder="Summarize key task highlights..."></textarea>

  <label>Challenges</label>
  <textarea formControlName="challenges" placeholder="List out the major challenges faced..."></textarea>

  <label>Support Needed</label>
  <textarea formControlName="supportNeeded" placeholder="Mention the support you expect..."></textarea>

  <label>Self Rating (1–5)</label>
  <input type="number" min="1" max="5" formControlName="selfRating" placeholder="Rate yourself" />

  <label>Additional Comments</label>
  <textarea formControlName="comments" placeholder="Add any other remarks or feedback..."></textarea>
</div>


    <div class="d-flex  justify-content-end">
      <button type="submit" class="gradientBtn mb-2 move-right">Submit</button>
    </div>
    <p *ngIf="submitted" class="success">✅ Successfully submitted your audit form!</p>
  </form>
</div> -->


<!-- Form Overlay -->

<div *ngIf="isFormLocked" class="form-lock-overlay">
  <div class="lock-message-box">
    <button class="close-icon" (click)="closeOverlay()">×</button>
    <i class="fas fa-lock"></i>
    <p>Audit Form Submitted</p>
    <p class="info-text">You may now close this form or return to dashboard.</p>
  </div>
</div>

<!-- Show table if designation is Founder & CEO -->
  <!-- ✅ Table of Audit Reports -->
<div *ngIf="employee.designation === 'Founder & CEO'; else auditFormBlock">

  <table class="table table-striped table-bordered">
    <thead>
      <tr>
        <th>Sr No</th>
        <th>Employee Name</th>
        <th>Employee ID</th>
        <th>Audit Form Review</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let report of auditReportList; let i = index">
        <td>{{ i + 1 }}</td>
        <td>{{ report.emp_name }}</td>
        <td>{{ report.emp_id }}</td>
        <td>
          <button class="small gradientBtn" (click)="selectedAudit = report">
            View Review
          </button>
        </td>
      </tr>
    </tbody>
  </table>
</div>


<!-- Template block for others -->
<ng-template #auditFormBlock>
  <div class="audit-wrapper">
    <form [formGroup]="auditForm" (ngSubmit)="submitForm()" class="audit-form" [class.locked]="isFormLocked">
      <!-- Section 1: Individual Overview -->
      <div class="section-header">
        <h2 class="headlevel-three mb-0">
          Individual Overview & Performance Identity
        </h2>
      </div>
      <div class="form-card">
        <div class="form-grid">
          <div class="form-field">
            <label>Employee Name</label><span class="font-size-17px">
              {{ employee.name }}
            </span>
          </div>
          <div class="form-field">
            <label>Employee ID</label><span class="font-size-17px">
              {{ employee.empId }}
            </span>
          </div>
          <div class="form-field">
            <label>Designation</label><span class="font-size-17px">
              {{ employee.designation }}
            </span>
          </div>
          <div class="form-field">
            <label>Department</label><span class="font-size-17px">
              {{ employee.department }}
            </span>
          </div>
          <div class="form-field">
            <label>Review Period</label
            ><select formControlName="review_period">
              <option value="q1">Q1</option>
              <option value="q2">Q2</option>
              <option value="h1">H1</option>
              <option value="annual">Annual</option>
            </select>
          </div>
          <div class="form-field">
            <label>Reporting Manager</label>
            <span class="font-size-16px">
              {{ employee.manager }}
            </span>
          </div>
          <div class="form-field">
            <label>Date of Joining</label><span class="font-size-16px">
              {{ employee.doj }}
            </span>
          </div>
          <div class="form-field">
            <label>Attendance %</label><span class="font-size-16px">
              {{ employee.attendance_percentage }}
            </span>
          </div>
          <div class="form-field">
            <label>Working Mode</label>
            <p class="work-mode">{{ employee.working_mode }}</p>
          </div>
          <div class="form-field radio-group">
            <label class="form-label font-weight-700">Audit Cycle Type</label>
            <div>
              <div class="mr-10px">
                <input
                  type="radio"
                  id="quarterly"
                  formControlName="audit_cycle_type"
                  value="quarterly"
                />
                <label for="quarterly">Quarterly</label>
              </div>

              <div class="mr-10px">
                <input
                  type="radio"
                  id="six_months"
                  formControlName="audit_cycle_type"
                  value="six_months"
                />
                <label for="six_months">6 Months</label>
              </div>
              <div class="mr-10px">
                <input
                  type="radio"
                  id="one_year"
                  formControlName="audit_cycle_type"
                  value="one_year"
                />
                <label for="one_year">1 Year</label>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Section 2: Self-Evaluation & Professional Insights -->
      <div class="section-header">
        <h2 class="headlevel-three mb-0">
          Self-Evaluation & Professional Insights
        </h2>
      </div>
      <div class="form-card">
        <div class="form-field">
          <label>Self-Rating (1 to 5)</label>
          <div class="star-rating">
            <ng-container *ngFor="let star of stars">
              <span
                class="star"
                [class.filled]="star <= (hoveredRating || selfRating)"
                (mouseenter)="onStarHover(star)"
                (mouseleave)="onStarLeave()"
                (click)="rate(star)"
              >
                ★
              </span>
            </ng-container>
          </div>
        </div>

        <!-- <div class="form-field"><label>Self-Rating (1 to 5)</label><div class="star-rating"><input type="radio" id="star5" formControlName="selfRating" value="5" /><label for="star5">★</label><input type="radio" id="star4" formControlName="selfRating" value="4" /><label for="star4">★</label><input type="radio" id="star3" formControlName="selfRating" value="3" /><label for="star3">★</label><input type="radio" id="star2" formControlName="selfRating" value="2" /><label for="star2">★</label><input type="radio" id="star1" formControlName="selfRating" value="1" /><label for="star1">★</label></div></div> -->
        <div class="form-field">
          <label>Technical Skills Used (Hold Ctl + click)</label
          ><select class="techselect" formControlName="technicalSkillsUsed" multiple>
            <option value="python">Python</option>
            <option value="docker">Docker</option>
            <option value="mongodb">MongoDB</option>
            <option value="flask">Flask</option>
            <option value="ci_cd">CI/CD</option>
          </select>
        </div>
        <div class="form-field checkbox-group" formGroupName="communicationCollaboration">
          <label class="font-weight-700">Communication & Collaboration</label>
          <div>
            <div formGroupName="dailyStandups" class="comm-item">
              <div>
                <input type="checkbox" id="comm1" formControlName="checked">
                <label for="comm1">Daily Standups</label>
              </div>
              <div class="radio-row" *ngIf="auditForm.get('communicationCollaboration.dailyStandups.checked')?.value">
                <label><input type="radio" formControlName="rating" value="good"> Good</label>
                <label><input type="radio" formControlName="rating" value="poor"> Poor</label>
                <label><input type="radio" formControlName="rating" value="excellent"> Excellent</label>
              </div>
            </div>
            <div formGroupName="clientMeetings" class="comm-item">
              <div>
                <input type="checkbox" id="comm2" formControlName="checked">
                <label for="comm2">Client Meetings</label>
              </div>
              <div class="radio-row" *ngIf="auditForm.get('communicationCollaboration.clientMeetings.checked')?.value">
                <label><input type="radio" formControlName="rating" value="good"> Good</label>
                <label><input type="radio" formControlName="rating" value="poor"> Poor</label>
                <label><input type="radio" formControlName="rating" value="excellent"> Excellent</label>
              </div>
            </div>
            <!-- <div formGroupName="slack" class="comm-item">
              <div>
                <input type="checkbox" id="comm3" formControlName="checked">
                <label for="comm3">Slack</label>
              </div>
              <div class="radio-row" *ngIf="auditForm.get('communicationCollaboration.slack.checked')?.value">
                <label><input type="radio" formControlName="rating" value="good"> Good</label>
                <label><input type="radio" formControlName="rating" value="poor"> Poor</label>
                <label><input type="radio" formControlName="rating" value="excellent"> Excellent</label>
              </div>
            </div> -->
          </div>
        </div>
        <!-- ADDED: Cross-Functional Involvement -->
        <div
          class="form-field checkbox-group"
          formGroupName="crossFunctionalInvolvement"
        >
          <label class="font-weight-700">Cross-Functional Involvement</label>
          <div>
            <div class="mr-10px">
              <input
                type="checkbox"
                id="cross1"
                formControlName="techSupport"
              />
              <label for="cross1">Tech Support</label>
            </div>
            <div class="mr-10px">
              <input type="checkbox" id="cross2" formControlName="bdSupport" />
              <label for="cross2">BD Support</label>
            </div>
          </div>
        </div>
        <div class="form-field">
          <label>Monthly Task Highlights</label>
          <textarea
            formControlName="monthlyTaskHighlights"
            placeholder="e.g., Closed 3 sprints, handled 1 hotfix..."
          ></textarea>
        </div>
        <!-- ADDED: Personal Highlights -->
        <div class="form-field">
          <label>Personal Highlights</label
          ><textarea
            formControlName="personalHighlights"
            placeholder="e.g., Deployed CI/CD pipeline independently"
          ></textarea>
        </div>
        <div class="form-field">
          <label>Areas to Improve</label
          ><textarea
            formControlName="areasToImprove"
            placeholder="e.g., Time estimation, sprint velocity..."
          ></textarea>
        </div>
        <!-- ADDED: Initiative Taken -->
        <div class="form-field checkbox-group" formGroupName="initiativeTaken">
          <label class="font-weight-700">Initiative Taken</label>
          <div>
            <div class="mr-10px">
              <input
                type="checkbox"
                id="init1"
                formControlName="processSuggestion"
              />
              <label for="init1">Process Suggestion</label>
            </div>
            <div class="mr-10px">
              <input
                type="checkbox"
                id="init2"
                formControlName="documentation"
              />
              <label for="init2">Documentation</label>
            </div>
          </div>
        </div>
        <!-- ADDED: Learning/Certifications Done -->
        <div class="form-field">
          <label>Learning/Certifications Done</label
          ><textarea
            formControlName="learningCertificationsDone"
            placeholder="e.g., AWS DevOps Bootcamp (Udemy)"
          ></textarea>
        </div>
        <!-- ADDED: Suggestions to Company -->
        <div class="form-field">
          <label>Suggestions to Company</label
          ><textarea
            formControlName="suggestionsToCompany"
            placeholder="e.g., Need shared test/stage environment"
          ></textarea>
        </div>
      </div>

      <!-- Section 3: Key Result Areas (KRAs) & Goal Evaluation -->
      <div class="section-header">
        <h2 class="headlevel-three mb-0">Key Result Areas & Goal Evaluation</h2>
      </div>
      <div class="form-card">
        <div class="form-field">
          <label>Previous Cycle Goals</label
          ><textarea
            formControlName="previousCycleGoals"
            placeholder="e.g., ResumeHub deployment by 25th May"
          ></textarea>
        </div>
        <div class="form-field">
          <label>Goal Achievement %</label
          ><input
            type="number"
            formControlName="goalAchievementPercentage"
            placeholder="e.g., 80"
          />
        </div>
        <div class="form-field">
          <label>KPI Metrics</label>
          <div class="file-upload">
            <input
              type="file" class="file-uploadBlock"
              (change)="onFileSelected($event, 'kpiMetricsFile')"
            />
            <div class="gradientBtn smallBlock">
              <i class="fas fa-cloud-upload-alt file-upload-icon mr-20px"></i
              ><span>Upload</span>
            </div>
            <span class="top-span">
              {{
                selectedFiles["kpiMetricsFile"]
              }}
            </span>
          </div>
        </div>
        <!-- ADDED: Projects Worked On -->
        <div class="form-field">
          <label>Projects Worked On</label
          ><textarea
            formControlName="projectsWorkedOn"
            placeholder="e.g., HR Chatbot, ATS Analyzer"
          ></textarea>
        </div>
        <!-- ADDED: Tasks/Modules Completed -->
        <div class="form-field">
          <label>Tasks/Modules Completed</label
          ><textarea
            formControlName="tasksModulesCompleted"
            placeholder="e.g., ResumeHub API refactor"
          ></textarea>
        </div>
        <!-- ADDED: Performance Evidences -->
        <div class="form-field">
          <label>Performance Evidences</label>
          <div class="file-upload">
            <input
              type="file" class="file-uploadBlock"
              (change)="onFileSelected($event, 'performanceEvidencesFile')"
            />
            <div class="gradientBtn smallBlock">
              <i class="fas fa-file-alt file-upload-icon mr-20px"></i
              ><span>

                  Upload
              </span>
            </div>
            <span class="top-span">{{
                selectedFiles["performanceEvidencesFile"]
              }}</span>
          </div>
        </div>
      </div>

      <!-- Section 4: Final Submission & Records -->
      <div class="section-header">
        <h2 class="headlevel-three mb-0">Final Submission & Records</h2>
      </div>
      <div class="form-card">
        <!-- ADDED: Additional Attachments (multi-file) -->
        <div class="form-field">
          <label>Additional Attachments</label>
          <div class="file-upload">
            <input
              type="file" class="file-uploadBlock"
              (change)="onFileSelected($event, 'attachments', true)"
              multiple
            />
            <div class="gradientBtn smallBlock">
              <i class="fas fa-paperclip file-upload-icon mr-20px"></i
              ><span>Upload</span>
            </div>
            <span class="top-span">{{
                selectedFiles["attachments"]
              }}</span>
          </div>
        </div>
        <div class="form-field">
          <label>Final Remarks (Optional)</label
          ><textarea
            formControlName="finalRemarks"
            placeholder="Add any other remarks..."
          ></textarea>
        </div>
        <div class="form-field checkbox-group acknowledgement">
          <div>
            <input
              type="checkbox"
              id="acknowledgement"
              formControlName="acknowledgement"
              required
            /><label for="acknowledgement"
              >I confirm the details shared are accurate</label
            >
          </div>
        </div>
      </div>

      <!-- Submit Button -->
      <div class="submit-container mb-2">
        <button
          type="submit"
          class="gradientBtn"
          [disabled]="!auditForm.valid || isLoading"
        >
          Submit
          <ng-template #loadingSpinner
            ><span class="loading"></span> Submitting...</ng-template
          >
        </button>
      </div>

      <!-- Feedback Messages -->
      <div
        *ngIf="submitted && auditForm.valid"
        class="feedback-message success"
      >
        <i class="fas fa-check-circle"></i>Successfully submitted your audit
        form!
      </div>
      <!-- <div
        *ngIf="submitted && auditForm.invalid"
        class="feedback-message error"
      >
        <i class="fas fa-exclamation-circle"></i>Please fill all required fields
        and confirm acknowledgement.
      </div> -->
    </form>
  </div>
</ng-template>

<!-- ✅ Modal for Showing Audit Review -->
<div *ngIf="selectedAudit" class="modal-overlay">
  <div class="modal-card">
    <div class="modal-content">
      <div
        class="modal-header d-flex justify-content-between align-items-center"
      >
        <div>
          <h2 class="headlevel-three mb-0">
            Employee Audit Details & Manager Review
          </h2>
        </div>
        <button class="closeicon" (click)="selectedAudit = null">x</button>
      </div>
    </div>

    <div class="model-body">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- 🔍 LEFT: Employee Full Audit Data -->
        <div class="space-y-4 border-r pr-4">
          <h4 class="headlevel-three">
            <i class="icon-briefcase"></i> Employee Review
          </h4>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label>Employee Name</label>
              <p>{{ selectedAudit?.emp_name }}</p>
            </div>
            <div>
              <label>Employee ID</label>
              <p>{{ selectedAudit?.emp_id }}</p>
            </div>
            <div>
              <label>Review Period</label>
              <p>{{ selectedAudit?.review_period }}</p>
            </div>
            <div>
              <label>Attendance %</label>
              <p>{{ selectedAudit?.attendance_percentage }}</p>
            </div>
            <div>
              <label class="font-weight-700">Audit Cycle Type</label>
              <p>{{ selectedAudit?.audit_cycle_type }}</p>
            </div>
          </div>

          <hr class="my-4" />

          <div class="mb-3">
            <label>Self-Rating</label>
            <p>{{ selectedAudit?.self_rating }}</p>
          </div>
          <div class="mb-3">
            <label>Technical Skills Used</label>
            <p>{{ selectedAudit?.technical_skills_used }}</p>
          </div>

          <div class="mb-3">
            <label>Communication & Collaboration</label>
            <p>{{ selectedAudit?.communication_collaboration }}</p>
          </div>

          <div class="mb-3">
            <label>Cross-Functional Involvement</label>
            <p>{{ selectedAudit?.cross_functional_involvement }}</p>
          </div>

          <div class="mb-3">
            <label>Monthly Task Highlights</label>
            <p>{{ selectedAudit?.task_highlight }}</p>
          </div>
          <div class="mb-3">
            <label>Personal Highlights</label>
            <p>{{ selectedAudit?.personal_highlight }}</p>
          </div>
          <div class="mb-3">
            <label>Areas to Improve</label>
            <p>{{ selectedAudit?.areas_to_improve }}</p>
          </div>

          <div class="mb-3">
            <label>Initiatives Taken</label>
            <p>{{ selectedAudit?.initiative_taken }}</p>
          </div>
          <div class="mb-3">
            <label>Learning/Certifications Done</label>
            <p>{{ selectedAudit?.learnings_certifications }}</p>
          </div>
          <div class="mb-3">
            <label>Suggestions to Company</label>
            <p>{{ selectedAudit?.suggestions_to_company }}</p>
          </div>

          <hr class="my-4" />

          <div class="mb-3">
            <label>Previous Cycle Goals</label>
            <p>{{ selectedAudit?.previous_cycle_goals }}</p>
          </div>
          <div class="mb-3">
            <label>Goal Achievement %</label>
            <p>{{ selectedAudit?.goal_achievement }}%</p>
          </div>
          <div class="mb-3">
            <label>Projects Worked On</label>
            <p>{{ selectedAudit?.projects_worked }}</p>
          </div>
          <div class="mb-3">
            <label>Tasks/Modules Completed</label>
            <p>{{ selectedAudit?.tasks_modules_completed }}</p>
          </div>
        </div>

        <!-- 🧑‍💼 RIGHT: Manager Review Form -->
        <!-- 🧑‍💼 RIGHT: Manager Review (Readonly View) -->
        <div class="form-card space-y-4">
          <h4 class="headlevel-three">
            <i class="icon-briefcase"></i> Manager Review
          </h4>

          <div class="mb-3">
            <label>Manager Review Comments</label>
            <p>{{ selectedAudit?.manager_review_comments || "N/A" }}</p>
          </div>

          <div class="mb-3">
            <label>Rating on Execution</label>
            <p>{{ selectedAudit?.execution_rating || "N/A" }}</p>
          </div>

          <div class="mb-3">
            <label>Rating on Innovation</label>
            <p>{{ selectedAudit?.innovation_rating || "N/A" }}</p>
          </div>

          <div class="mb-3">
            <label>Attendance & Discipline Score</label>
            <p>{{ selectedAudit?.attendance_discipline_score || "N/A" }}</p>
          </div>

          <div class="mb-3">
            <label>Quality of Delivery</label>
            <p>{{ selectedAudit?.delivery_quality || "N/A" }}</p>
          </div>

          <div class="mb-3">
            <label>Ownership & Initiative</label>
            <p>{{ selectedAudit?.ownership_initiative || "N/A" }}</p>
          </div>

          <div class="mb-3">
            <label>Contribution to Team Growth</label>
            <p>{{ selectedAudit?.team_growth_contribution || "N/A" }}</p>
          </div>

          <div class="mb-3">
            <label>Promotion/Action Suggested</label>
            <p>{{ selectedAudit?.promotion_action_suggested || "N/A" }}</p>
          </div>

          <div class="mb-3">
            <label>Final Remarks</label>
            <p>{{ selectedAudit?.final_remarks || "N/A" }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
